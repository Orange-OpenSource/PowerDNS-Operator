{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Introduction","text":"<p>PowerDNS Operator is a Kubernetes operator that manages PowerDNS service.</p> <p>With PowerDNS Operator you can manage zones, records and other PowerDNS resources directly from Kubernetes. It is designed to be a simple and easy-to-use solution to manage PowerDNS directly from Kubernetes through Custom Resources. The PowerDNS service can be located inside or outside of Kubernetes, it does not matter since the Operator relies on the PowerDNS API.</p> <p>Info</p> <p>This project use the official PowerDNS API and cannot be plugged to PowerDNS-Admin project which implement its own specific API on top PowerDNS's API. There is no issue if you want to use both projects together, but the operator can only relies on the official API and you may notice issues if you try to use PowerDNS-Admin to manage the same resources as the operator.</p>"},{"location":"#why-use-powerdns-operator","title":"Why use PowerDNS Operator?","text":"<p>We needed to offer DNS capabilities to users and considered relying on the PowerDNS-Admin project. However, we wanted a more flexible solution that could be natively integrated with our existing Kubernetes infrastructure. We were also looking for a solution that could be easily integrated with our GitOps workflow to automate the creation of DNS records as well as other resources such as Ingress, Services, etc.</p> <p>Another reason is that the PowerDNS-Admin project is not in good health and will probably be rewritten in the future. We wanted a solution that is more reliable and easily maintained.</p> <p>The PowerDNS Operator is a convenient way to offer self-service DNS capabilities to users, allowing them to create resources directly in the Kubernetes cluster. Additionally, you can use Backstage or any Internal Developer Platform and connect it to the Kubernetes API server that contains the PowerDNS Operator if you don't want to grant direct access to the Kubernetes cluster.</p>"},{"location":"guides/clusterzones/","title":"ClusterZone deployment","text":""},{"location":"guides/clusterzones/#specification","title":"Specification","text":"<p>The specification of the <code>ClusterZone</code> contains the following fields:</p> Field Type Required Description kind string Y Kind of the zone, one of \"Native\", \"Master\", \"Slave\", \"Producer\", \"Consumer\" nameservers []string Y List of the nameservers of the zone catalog string N The catalog this zone is a member of soa_edit_api string N The SOA-EDIT-API metadata item, one of \"DEFAULT\", \"INCREASE\", \"EPOCH\", defaults to \"DEFAULT\""},{"location":"guides/clusterzones/#example","title":"Example","text":"<pre><code>apiVersion: dns.cav.enablers.ob/v1alpha2\nkind: ClusterZone\nmetadata:\n  name: helloworld.com\nspec:\n  nameservers:\n    - ns1.helloworld.com\n    - ns2.helloworld.com\n  kind: Master\n  catalog: catalog.helloworld\n  soa_edit_api: EPOCH\n</code></pre>"},{"location":"guides/metrics/","title":"Metrics","text":"<p>PowerDNS-Operator exposes metrics in Prometheus format.  </p> Name Type Description Available labels clusterzones_status gauge Statuses of ClusterZones processed name, status zones_status gauge Statuses of Zones processed name, namespace ,status rrsets_status gauge Statuses of RRsets processed fqdn, name, namespace, status, type"},{"location":"guides/metrics/#example","title":"Example","text":"<p>The following metrics are based on the example defined here</p> <pre><code>clusterzones_status{name=\"example.org\",status=\"Succeeded\"} 1\nrrsets_status{fqdn=\"example.org.\",name=\"mx.example.org\",namespace=\"example\",status=\"Succeeded\",type=\"MX\"} 1\nrrsets_status{fqdn=\"example.org.\",name=\"soa.example.org\",namespace=\"example\",status=\"Succeeded\",type=\"SOA\"} 1\nrrsets_status{fqdn=\"ns1.example.org.\",name=\"ns1.example.org\",namespace=\"example\",status=\"Succeeded\",type=\"A\"} 1\nrrsets_status{fqdn=\"ns2.example.org.\",name=\"ns2.example.org\",namespace=\"example\",status=\"Succeeded\",type=\"A\"} 1\n\nzones_status{name=\"myapp1.example.org\",namespace=\"myapp1\",status=\"Succeeded\"} 1\nrrsets_status{fqdn=\"myapp1.example.org.\",name=\"soa.myapp1.example.org\",namespace=\"myapp1\",status=\"Succeeded\",type=\"SOA\"} 1\nrrsets_status{fqdn=\"front.myapp1.example.org.\",name=\"front.myapp1.example.org\",namespace=\"myapp1\",status=\"Succeeded\",type=\"A\"} 1\n</code></pre>"},{"location":"guides/rrsets/","title":"RRset deployment","text":""},{"location":"guides/rrsets/#specification","title":"Specification","text":"<p>The specification of the <code>RRset</code> contains the following fields:</p> Field Type Required Description type string Y Type of the record (e.g. \"A\", \"PTR\", \"MX\") name string Y Name of the record ttl uint32 Y DNS TTL of the records, in seconds records []string Y All records in this Resource Record Set comment string N Comment on RRSet zoneRef ZoneRef Y ZoneRef reference the zone the RRSet depends on <p>The specification of the <code>ZoneRef</code> contains the following fields:</p> Field Type Required Description name string Y Name of the <code>ClusterZone</code>/<code>Zone</code> kind string Y Kind of zone (Zone/ClusterZone)"},{"location":"guides/rrsets/#example","title":"Example","text":"<pre><code>apiVersion: dns.cav.enablers.ob/v1alpha2\nkind: RRset\nmetadata:\n  name: test.helloworld.com\n  namespace: default\nspec:\n  comment: nothing to tell\n  type: A\n  name: test\n  ttl: 300\n  records:\n    - 1.1.1.1\n    - 2.2.2.2\n  zoneRef:\n    name: helloworld.com\n    kind: \"Zone\"\n</code></pre> <p>Note: The name can be canonical or not. If not, the name of the <code>ClusterZone</code>/<code>Zone</code> will be appended</p>"},{"location":"guides/warnings/","title":"Warnings on field format","text":""},{"location":"guides/warnings/#deal-with-canonical-names","title":"Deal with canonical names","text":"<p>For some resources such as CNAME, PTR, MX, SRV, the records field MUST be in canonical format (end with a dot \".\"). See following examples.</p>"},{"location":"guides/warnings/#cname","title":"CNAME","text":"<pre><code>---\napiVersion: dns.cav.enablers.ob/v1alpha2\nkind: RRset\nmetadata:\n  name: test4.helloworld.com\nspec:\n  type: CNAME\n  name: test4\n  ttl: 300\n  records:\n    - test1.helloworld.com.\n  zoneRef:\n    name: helloworld.com\n    kind: \"Zone\"\n</code></pre>"},{"location":"guides/warnings/#ptr","title":"PTR","text":"<pre><code>---\napiVersion: dns.cav.enablers.ob/v1alpha2\nkind: RRset\nmetadata:\n  name: 1.1.168.192.in-addr.arpa.helloworld.com\nspec:\n  type: PTR\n  name: \"1\"\n  ttl: 300\n  records:\n    - mailserver.helloworld.com.\n  zoneRef:\n    name: 1.168.192.in-addr.arpa\n    kind: \"Zone\"\n</code></pre>"},{"location":"guides/warnings/#mx","title":"MX","text":"<pre><code>---\napiVersion: dns.cav.enablers.ob/v1alpha2\nkind: RRset\nmetadata:\n  name: mx.helloworld.com\nspec:\n  type: MX\n  name: \"helloworld.com.\"\n  ttl: 300\n  records:\n    - \"10 mailserver1.helloworld.com.\"\n    - \"20 mailserver2.helloworld.com.\"\n  zoneRef:\n    name: helloworld.com\n    kind: \"Zone\"\n</code></pre>"},{"location":"guides/warnings/#srv","title":"SRV","text":"<pre><code>---\napiVersion: dns.cav.enablers.ob/v1alpha2\nkind: RRset\nmetadata:\n  name: database.srv.helloworld.com\nspec:\n  type: SRV\n  name: \"_database._tcp.myapp\"\n  ttl: 300\n  records:\n    - 1 50 25565 test2.helloworld.com.\n  zoneRef:\n    name: helloworld.com\n    kind: \"Zone\"\n</code></pre>"},{"location":"guides/warnings/#txt-records","title":"TXT Records","text":"<p>Sometime, you may encounter the following error when applying a <code>RRset</code> custom resource: <pre><code>status:\n  syncErrorDescription: 'Record helloworld.com./TXT ''Welcome to the helloworld.com\n    domain'': Parsing record content (try ''pdnsutil check-zone''): Data field in\n    DNS should start with quote (\") at position 0 of ''Welcome to the helloworld.com\n    domain'''\n  syncStatus: Failed\n</code></pre></p> <p>This error is due to a wrong format for the <code>RRset</code>. TXT records MUST start AND end with an escaped quote (\\\"). See following example.  </p> <pre><code>---\napiVersion: dns.cav.enablers.ob/v1alpha2\nkind: RRset\nmetadata:\n  name: txt.helloworld.com\nspec:\n  type: TXT\n  name: \"helloworld.com.\"\n  ttl: 300\n  records:\n    - \"\\\"Welcome to the helloworld.com domain\\\"\"\n  zoneRef:\n    name: helloworld.com\n    kind: \"Zone\"\n</code></pre>"},{"location":"guides/zones/","title":"Zone deployment","text":""},{"location":"guides/zones/#specification","title":"Specification","text":"<p>The specification of the <code>Zone</code> contains the following fields:</p> Field Type Required Description kind string Y Kind of the zone, one of \"Native\", \"Master\", \"Slave\", \"Producer\", \"Consumer\" nameservers []string Y List of the nameservers of the zone catalog string N The catalog this zone is a member of soa_edit_api string N The SOA-EDIT-API metadata item, one of \"DEFAULT\", \"INCREASE\", \"EPOCH\", defaults to \"DEFAULT\""},{"location":"guides/zones/#example","title":"Example","text":"<pre><code>apiVersion: dns.cav.enablers.ob/v1alpha2\nkind: Zone\nmetadata:\n  name: helloworld.com\n  namespace: default\nspec:\n  nameservers:\n    - ns1.helloworld.com\n    - ns2.helloworld.com\n  kind: Master\n  catalog: catalog.helloworld\n  soa_edit_api: EPOCH\n</code></pre>"},{"location":"introduction/faq/","title":"FAQ","text":""},{"location":"introduction/faq/#can-i-use-powerdns-admin-and-powerdns-operator-together","title":"Can I use PowerDNS-Admin and PowerDNS Operator together?","text":"<p>No, the operator only supports the official PowerDNS API. The PowerDNS-Admin project implements its own specific API on top of PowerDNS's API. There is no issue if you want to use both projects together, but the operator can only rely on the official API. You may notice issues if you try to use PowerDNS-Admin to manage the same resources as the operator.</p>"},{"location":"introduction/faq/#can-i-manage-multiple-powerdns-servers-with-a-single-operator","title":"Can I manage multiple PowerDNS servers with a single operator?","text":"<p>No, the operator is designed to manage a single PowerDNS server. If you need to manage multiple PowerDNS servers, you will have to deploy multiple instances of the operator in multiple Kubernetes clusters, each one managing a different PowerDNS server.</p> <p>This may be technically possible in the future, but it is not a priority for the project.</p>"},{"location":"introduction/faq/#can-i-set-an-interval-to-check-for-drifts-between-the-powerdns-server-and-the-kubernetes-resources","title":"Can I set an interval to check for drifts between the PowerDNS server and the Kubernetes resources?","text":"<p>The operator will not loop on each resource to check if it is in sync with the PowerDNS server. It will only react to events (create, update, delete) on the resources. If you update the resources, the operator will update the PowerDNS server accordingly. If you delete the resources, the operator will delete the resources from PowerDNS.</p> <p>This should be relatively easy to implement in the future if needed, allowing the user to choose a loop interval to remediate potential drifts.</p>"},{"location":"introduction/getting-started/","title":"Getting Started","text":"<p>PowerDNS Operator runs within your Kubernetes cluster as a deployment resource. It utilizes CustomResourceDefinitions (CRDs) to manage PowerDNS resources. The Operator communicates with the PowerDNS API to manage zones and records.</p>"},{"location":"introduction/getting-started/#pre-requisites","title":"Pre-requisites","text":"<p>Before you can install PowerDNS Operator, you need to have the following:</p> <ul> <li>A Kubernetes cluster v1.29.0 or later</li> <li>A PowerDNS server v4.7 or later</li> </ul> <p>Note: The PowerDNS API must be enabled and accessible from the Kubernetes cluster where the operator is running.</p>"},{"location":"introduction/getting-started/#installing-with-kustomize","title":"Installing with Kustomize","text":"<p>Create the namespace and create a Secret containing the needed PowerDNS variables but you can also create the Secret using External Secrets or any other secret management tool.</p> <p>Theses secrets are used to configure the PowerDNS Operator to connect to the PowerDNS API.</p> <pre><code>kubectl create namespace powerdns-operator-system\nkubectl apply -f - &lt;&lt;EOF\napiVersion: v1\nkind: Secret\nmetadata:\n  name: powerdns-operator-manager\n  namespace: powerdns-operator-system\ntype: Opaque\nstringData:\n  PDNS_API_URL: https://powerdns.example.local:8081\n  PDNS_API_KEY: secret\n  PDNS_API_VHOST: localhost\nEOF\n</code></pre> <p>Install the latest version using the following command:</p> <pre><code>kubectl apply -k https://github.com/Orange-OpenSource/PowerDNS-Operator/releases/latest/download/bundle.yaml\n</code></pre> <p>Or you can specify a specific version (e.g. <code>v0.1.0</code>):</p> <pre><code>kubectl apply -k https://github.com/Orange-OpenSource/PowerDNS-Operator/releases/download/v0.1.0/bundle.yaml\n</code></pre>"},{"location":"introduction/getting-started/#installing-with-helm","title":"Installing with Helm","text":"<p>A Helm chart is available on a specific project.</p>"},{"location":"introduction/overview/","title":"API Overview","text":""},{"location":"introduction/overview/#architecture","title":"Architecture","text":"<p>The PowerDNS-Operator extends Kubernetes with Custom Resources, which define Zones and Records. The controller fetches ClusterZones, Zones and RRsets from the cluster and creates PowerDNS elements (Zones and Records). Each modification on these Custom Resources will be applied on PowerDNS instance accordingly.</p>"},{"location":"introduction/overview/#resource-model","title":"Resource Model","text":"<p>To understand the mechanics of the operator let's start with an example.</p> <ol> <li>The <code>ClusterZone</code> resource, created by Platform Team, references a root Zone (example.org). <pre><code>---\napiVersion: dns.cav.enablers.ob/v1alpha2\nkind: ClusterZone\nmetadata:\n  name: example.org\nspec:\n  nameservers:\n    - ns1.example.org\n    - ns2.example.org\n  kind: Native\n</code></pre></li> <li>Some <code>RRsets</code> in the 'example' namespace can reference records related to the <code>ClusterZone</code> (such nameservers IPs, mail servers, SOA, ...). <pre><code>---\napiVersion: dns.cav.enablers.ob/v1alpha2\nkind: RRset\nmetadata:\n  name: soa.example.org\n  namespace: example\nspec:\n  name: example.org.\n  records:\n  - ns1.example.org. admin.example.org. 1 10800 3600 604800 3600\n  ttl: 3600\n  type: SOA\n  zoneRef:\n    name: example.org\n    kind: ClusterZone\n---\napiVersion: dns.cav.enablers.ob/v1alpha2\nkind: RRset\nmetadata:\n  name: mx.example.org\n  namespace: example\nspec:\n  type: MX\n  name: \"example.org.\"\n  ttl: 300\n  records:\n    - \"10 mx1.example.org.\"\n    - \"20 mx2.example.org.\"\n  zoneRef:\n    name: example.org\n    kind: ClusterZone\n---\napiVersion: dns.cav.enablers.ob/v1alpha2\nkind: RRset\nmetadata:\n  name: ns1.example.org\n  namespace: example\nspec:\n  type: A\n  name: ns1\n  ttl: 300\n  records:\n    - \"10.25.32.1\"\n  zoneRef:\n    name: example.org\n    kind: ClusterZone\n---\napiVersion: dns.cav.enablers.ob/v1alpha2\nkind: RRset\nmetadata:\n  name: ns2.example.org\n  namespace: example\nspec:\n  type: A\n  name: ns2\n  ttl: 300\n  records:\n    - \"10.25.32.2\"\n  zoneRef:\n    name: example.org\n    kind: ClusterZone\n</code></pre></li> <li>The <code>Zone</code>, in the 'myapp1' namespace, can be created by Application Team or Platform Team depending on the Authorization model choosen, reference a Sub-Zone for Application purposes. <pre><code>---\napiVersion: dns.cav.enablers.ob/v1alpha2\nkind: Zone\nmetadata:\n  name: myapp1.example.org\n  namespace: myapp1\nspec:\n  nameservers:\n    - ns1.example.org\n    - ns2.example.org\n  kind: Native\n</code></pre></li> <li>The <code>RRsets</code> in the 'myapp1' namespace, created by Application Team, reference services provided by the Application (frontend, backend, database, ...). <pre><code>---\napiVersion: dns.cav.enablers.ob/v1alpha2\nkind: RRset\nmetadata:\n  name: soa.myapp1.example.org\n  namespace: myapp1\nspec:\n  name: myapp1.example.org.\n  records:\n  - ns1.example.org. admin.example.org. 1 10800 3600 604800 3600\n  ttl: 3600\n  type: SOA\n  zoneRef:\n    name: myapp1.example.org\n    kind: Zone\n---\napiVersion: dns.cav.enablers.ob/v1alpha2\nkind: RRset\nmetadata:\n  name: front.myapp1.example.org\n  namespace: myapp1\nspec:\n  type: A\n  name: front\n  ttl: 300\n  records:\n    - \"1.2.3.4\"\n  zoneRef:\n    name: myapp1.example.org\n    kind: Zone\n</code></pre></li> </ol> <p>Such a structure allows a separation of elements, the application team can only administer the <code>RRsets</code> linked to its services</p> <p>Each <code>RRset</code> refers to the ClusterZone/Zone it depends on.</p>"},{"location":"introduction/overview/#behavior","title":"Behavior","text":"<p>The PowerDNS-Operator (PDNS-OP for brevity) reconciles <code>ClusterZones</code> or <code>Zones</code> in the following manner:</p> <ol> <li>PDNS-OP verifies that no other <code>Zone</code> or <code>ClusterZone</code> already exists with the same FQDN (Fully Qualified Domain Name), if exists, <code>Zone</code>/<code>ClusterZone</code> status is defined as 'Failed'</li> <li>PDNS-OP requests PowerDNS API to create/modify the corresponding resource</li> <li>PDNS-OP requests PowerDNS API to create/modify related 'Nameservers' entries</li> <li>PDNS-OP updates resource Status (including Serial) and its metrics</li> </ol> <p>The PowerDNS-Operator reconciles <code>RRsets</code> in the following manner:</p> <ol> <li>PDNS-OP verifies that the corresponding <code>ClusterZone</code>/<code>Zone</code> already exists, if not, It schedule a new reconciliation later on</li> <li>PDNS-OP verifies that the corresponding <code>ClusterZone</code>/<code>Zone</code> is not in 'Failed' status, in that case , <code>RRset</code> status is defined as 'Failed'</li> <li>PDNS-OP requests PowerDNS API to create/modify the corresponding resource</li> <li>PDNS-OP updates resource Status and its metrics</li> <li>PDNS-OP schedule a reconciliation to update <code>ClusterZone</code>/<code>Zone</code> Status (including Serial)</li> </ol>"},{"location":"introduction/overview/#roles-and-responsibilities","title":"Roles and responsibilities","text":"<p>The PowerDNS-Operator is designed to target the following persona:</p> <ul> <li>Cluster Operator: The cluster operator is responsible for configuring PowerDNS instance, ,</li> <li>Platform Team: The Platform team is responsible for defining the architecture <code>ClusterZone</code>, <code>Zone</code> and <code>RRset</code>, setting the permissions for application team (e.g. permissions to create Zones in their namespaces),</li> <li>Application Team: The Application developer is responsible for defining <code>RRsets</code> related to their services.</li> </ul> <p>Each persona will roughly map to a Kubernetes RBAC role. Depending on your environment these roles can map to a single user. Note: The PowerDNS Operator does not manage the PowerDNS instance lifecycle.</p>"},{"location":"introduction/stability-support/","title":"Stability and Support","text":""},{"location":"introduction/stability-support/#breaking-changes-introduced-in-v04x-versions","title":"Breaking changes introduced in v0.4.x versions","text":"<p>We noticed lacks of security and delegation possibilities with &lt;=v0.3.x versions, so we decided to split previous <code>Zone</code> in 2 differents Custom Resources: </p> <ul> <li><code>ClusterZone</code> (cluster-wide resource)</li> <li><code>Zone</code> (namespaced resource)</li> </ul> <p>This decision introduces breaking changes</p> <ul> <li><code>Zone</code> was previously cluster-wide resource become namespace-scoped</li> <li><code>rrset.spec.zoneRef.kind</code> is a new mandatory field to indicate whereas the <code>RRset</code> depends on a <code>Zone</code> or a <code>ClusterZone</code></li> <li><code>rrset.status.syncErrorDescription</code> is replaced by a <code>Status.Condition</code> field as adviced by the community<sup>1</sup><sup>2</sup></li> </ul> <ol> <li> <p>https://heidloff.net/article/storing-state-status-kubernetes-resources-conditions-operators-go/\u00a0\u21a9</p> </li> <li> <p>https://maelvls.dev/kubernetes-conditions/\u00a0\u21a9</p> </li> </ol>"},{"location":"testing_environment/k3d/","title":"Kubernetes cluster with k3d (https://k3d.io/stable/)","text":"<p>Other solutions such as Talos, minikube, kind, ... can be used</p>"},{"location":"testing_environment/k3d/#private-registry","title":"Private registry","text":"<p>To create a private local registry: <pre><code>k3d registry create registry.localhost --port 5000\n</code></pre></p>"},{"location":"testing_environment/k3d/#kubernetes-cluster","title":"Kubernetes Cluster","text":"<p>The following configuration file is used to deploy a 3-node cluster for testing purposes with the below features:</p> <ul> <li>Traefik ingress controller on http port 18081</li> <li>CSI default Storage on the Host directory <code>/mnt/k3d</code> (Usefaul to persist mariadb data)</li> <li>Private registry access configured</li> </ul> <p><pre><code>cat &gt; ~/.k3d/k3d-cluster.yaml &lt;&lt;EOF\napiVersion: k3d.io/v1alpha5\nkind: Simple\nmetadata:\n  name: k3d\nservers: 1\nagents: 2\nvolumes:\n  - volume: \"/etc/ssl/certs/ca-certificates.crt:/etc/ssl/certs/ca-certificates.crt\"\n  - volume: /mnt/k3d:/var/lib/rancher/k3s/storage\n    nodeFilters:\n      - server:0\n      - agent:*\nports:\n  - port: 18081:80\n    nodeFilters:\n      - loadbalancer\nregistries:\n  use:\n    - k3d-registry.localhost:5000\nEOF\n</code></pre> <pre><code>k3d cluster create --config ~/.k3d/k3d-cluster.yaml\n</code></pre></p>"},{"location":"testing_environment/powerdns/","title":"PowerDNS cluster deployment","text":"<p>For a full clustered powerdns instance, See Here</p>"}]}